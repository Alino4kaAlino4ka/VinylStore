# Модуль Базы Данных (database)

Этот модуль отвечает за все взаимодействия с базой данных и служит единым слоем персистентности для проекта "audio-store".

## Структура модуля

- `models.py`: Содержит определение доменных моделей с использованием SQLAlchemy ORM. Здесь описаны сущности, такие как `Audiobook`, `Author` и `Category`, а также их связи.
- `connection.py`: Отвечает за настройку подключения к базе данных, предоставляет "фабрику сессий" для создания сеансов и включает утилиты для инициализации БД.

## Основные компоненты

### 1. Модели (`models.py`)
Определяет схему базы данных через классы Python. Основные модели:
- `VinylRecord`: Агрегат, представляющий виниловую пластинку.
- `Author`: Сущность автора.
- `Category`: Сущность категории/жанра.

### 2. Подключение (`connection.py`)
- **DATABASE_URL**: Строка подключения к базе данных. В данном случае, это локальный файл SQLite `audio_store.db`.
- **engine**: Центральный объект SQLAlchemy, который управляет подключениями к БД.
- **SessionLocal**: "Фабрика сессий", которая создает новые объекты `Session` для взаимодействия с базой данных.
- **get_db()**: Функция-зависимость (для FastAPI), которая предоставляет сеанс работы с базой данных на один запрос и гарантирует его закрытие после завершения.
- **init_db()**: Функция для инициализации базы данных. Она создает все таблицы, определенные в `models.py`.

## Использование

### Инициализация базы данных
Для создания файла `audio_store.db` и всех необходимых таблиц, запустите скрипт `init_db.py` из корневого каталога проекта:
```bash
python init_db.py
```
Эта команда вызовет функцию `init_db()` из модуля `connection.py`.

### Получение сессии в приложении
Чтобы получить сессию для работы с базой данных внутри вашего сервиса (например, в эндпоинте FastAPI), используйте зависимость `get_db`:

```python
from fastapi import Depends, FastAPI
from sqlalchemy.orm import Session
from .database.connection import get_db, init_db

app = FastAPI()

@app.on_event("startup")
def on_startup():
    init_db()

@app.get("/books/")
def read_books(db: Session = Depends(get_db)):
    # Ваш код для работы с db...
    pass
