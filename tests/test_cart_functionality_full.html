<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–æ—Ä–∑–∏–Ω—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0F1014;
            color: #EAEAEA;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #FF9900;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            background-color: #1A1B20;
            border: 1px solid #2A2B30;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-section h2 {
            color: #FF9900;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .test-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #0F1014;
            border-radius: 6px;
            border-left: 3px solid #2A2B30;
        }
        
        .test-item.passed {
            border-left-color: #28a745;
        }
        
        .test-item.failed {
            border-left-color: #dc3545;
        }
        
        .test-item.warning {
            border-left-color: #ffc107;
        }
        
        .test-button {
            background-color: #FF9900;
            color: #0F1014;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }
        
        .test-button:hover {
            background-color: #e68900;
        }
        
        .test-button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .result.success {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }
        
        .result.error {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid #dc3545;
        }
        
        .result.info {
            background-color: rgba(255, 153, 0, 0.2);
            color: #FF9900;
            border: 1px solid #FF9900;
        }
        
        pre {
            background-color: #0F1014;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: #1A1B20;
            border: 1px solid #2A2B30;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #FF9900;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #ADADAD;
            font-size: 14px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #FF9900;
            color: #0F1014;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–æ—Ä–∑–∏–Ω—ã</h1>
        
        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
                <div class="stat-value" id="total-tests">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
                <div class="stat-value" id="passed-tests" style="color: #28a745;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div>
                <div class="stat-value" id="failed-tests" style="color: #dc3545;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                <div class="stat-value" id="success-rate">0%</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>1. –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∫–æ—Ä–∑–∏–Ω—ã (cart.js)</h2>
            <div id="cart-system-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>2. –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ (catalog.js)</h2>
            <div id="catalog-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>3. –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (book-detail.js)</h2>
            <div id="book-detail-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã</h2>
            <div id="integration-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>5. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <button class="test-button" onclick="testManualAdd()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤—Ä—É—á–Ω—É—é (ID: 1)</button>
            <button class="test-button" onclick="testManualAddMultiple()">–î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤</button>
            <button class="test-button" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
            <button class="test-button" onclick="showCartState()">–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã</button>
            <div id="manual-test-results"></div>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ -->
    <script src="src/scripts/cart.js"></script>
    <script src="src/scripts/catalog.js"></script>
    <script>
        // –°—á–µ—Ç—á–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('total-tests').textContent = totalTests;
            document.getElementById('passed-tests').textContent = passedTests;
            document.getElementById('failed-tests').textContent = failedTests;
            const rate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            document.getElementById('success-rate').textContent = rate + '%';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–∞
        function addTestResult(containerId, testName, passed, message, details = null) {
            totalTests++;
            if (passed) {
                passedTests++;
            } else {
                failedTests++;
            }
            updateStats();
            
            const container = document.getElementById(containerId);
            const testItem = document.createElement('div');
            testItem.className = `test-item ${passed ? 'passed' : 'failed'}`;
            
            const status = passed ? '‚úÖ' : '‚ùå';
            testItem.innerHTML = `
                <strong>${status} ${testName}</strong>
                <div class="result ${passed ? 'success' : 'error'}">${message}</div>
                ${details ? `<pre>${JSON.stringify(details, null, 2)}</pre>` : ''}
            `;
            
            container.appendChild(testItem);
        }
        
        // –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∫–æ—Ä–∑–∏–Ω—ã
        function testCartSystem() {
            const container = document.getElementById('cart-system-tests');
            container.innerHTML = '';
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ—É–Ω–∫—Ü–∏–π
            const hasAddToCart = typeof window.addToCartWithQuantity === 'function';
            addTestResult('cart-system-tests', 
                '–§—É–Ω–∫—Ü–∏—è addToCartWithQuantity –¥–æ—Å—Ç—É–ø–Ω–∞',
                hasAddToCart,
                hasAddToCart ? '–§—É–Ω–∫—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞' : '–§—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'
            );
            
            const hasGetCart = typeof window.getCartWithQuantity === 'function';
            addTestResult('cart-system-tests',
                '–§—É–Ω–∫—Ü–∏—è getCartWithQuantity –¥–æ—Å—Ç—É–ø–Ω–∞',
                hasGetCart,
                hasGetCart ? '–§—É–Ω–∫—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞' : '–§—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'
            );
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã getCartWithQuantity
            try {
                const cart = window.getCartWithQuantity();
                const isObject = typeof cart === 'object' && cart !== null;
                addTestResult('cart-system-tests',
                    'getCartWithQuantity –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç',
                    isObject,
                    isObject ? '–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—É—á–µ–Ω–∞' : '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã',
                    { cart }
                );
            } catch (e) {
                addTestResult('cart-system-tests',
                    'getCartWithQuantity —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫',
                    false,
                    `–û—à–∏–±–∫–∞: ${e.message}`
                );
            }
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
            try {
                const testId = 'test-' + Date.now();
                window.addToCartWithQuantity(testId);
                const cart = window.getCartWithQuantity();
                const hasItem = cart[testId] === 1;
                
                // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                delete cart[testId];
                window.saveCartWithQuantity(cart);
                
                addTestResult('cart-system-tests',
                    '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É',
                    hasItem,
                    hasItem ? '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω' : '–¢–æ–≤–∞—Ä –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω',
                    { testId, quantity: cart[testId] }
                );
            } catch (e) {
                addTestResult('cart-system-tests',
                    '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ –æ—à–∏–±–æ–∫',
                    false,
                    `–û—à–∏–±–∫–∞: ${e.message}`
                );
            }
        }
        
        // –¢–µ—Å—Ç—ã –∫–∞—Ç–∞–ª–æ–≥–∞
        function testCatalog() {
            const container = document.getElementById('catalog-tests');
            container.innerHTML = '';
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ addToCart
            const hasAddToCart = typeof addToCart === 'function';
            addTestResult('catalog-tests',
                '–§—É–Ω–∫—Ü–∏—è addToCart –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ catalog.js',
                hasAddToCart,
                hasAddToCart ? '–§—É–Ω–∫—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞' : '–§—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'
            );
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ loadCartCount
            const hasLoadCartCount = typeof loadCartCount === 'function';
            addTestResult('catalog-tests',
                '–§—É–Ω–∫—Ü–∏—è loadCartCount –¥–æ—Å—Ç—É–ø–Ω–∞',
                hasLoadCartCount,
                hasLoadCartCount ? '–§—É–Ω–∫—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞' : '–§—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'
            );
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã addToCart (—Å–∏–º—É–ª—è—Ü–∏—è)
            if (typeof addToCart === 'function') {
                try {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ audiobooks
                    const originalAudiobooks = window.audiobooks || [];
                    
                    // –°–æ–∑–¥–∞–µ–º –º–æ–∫ –¥–∞–Ω–Ω—ã—Ö - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–∞—Å—Å–∏–≤
                    const testBook = {
                        id: 'test-catalog-' + Date.now(),
                        title: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–∏–≥–∞',
                        name: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–∏–≥–∞',
                        price: 100,
                        image: 'test.jpg',
                        description: '–¢–µ—Å—Ç'
                    };
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º audiobooks –∫–∞–∫ –º–∞—Å—Å–∏–≤ —Å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–Ω–∏–≥–æ–π
                    window.audiobooks = [testBook];
                    
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
                    const cartBefore = window.getCartWithQuantity();
                    const quantityBefore = cartBefore[testBook.id] || 0;
                    
                    // –ü—Ä–æ–±—É–µ–º –≤—ã–∑–≤–∞—Ç—å addToCart
                    addToCart(testBook.id);
                    
                    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                    setTimeout(() => {
                        try {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ–±–∞–≤–∏–ª–æ—Å—å –ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
                            const cartAfter = window.getCartWithQuantity();
                            const quantityAfter = cartAfter[testBook.id] || 0;
                            const wasAdded = quantityAfter === quantityBefore + 1;
                            
                            // –û—á–∏—â–∞–µ–º
                            delete cartAfter[testBook.id];
                            window.saveCartWithQuantity(cartAfter);
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                            window.audiobooks = originalAudiobooks;
                            
                            addTestResult('catalog-tests',
                                'addToCart –∏–∑ catalog.js —Ä–∞–±–æ—Ç–∞–µ—Ç',
                                wasAdded,
                                wasAdded ? '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ addToCart' : `–¢–æ–≤–∞—Ä –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω (–±—ã–ª–æ: ${quantityBefore}, —Å—Ç–∞–ª–æ: ${quantityAfter})`
                            );
                        } catch (e2) {
                            window.audiobooks = originalAudiobooks;
                            addTestResult('catalog-tests',
                                'addToCart –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞',
                                false,
                                `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${e2.message}`
                            );
                        }
                    }, 200);
                    
                } catch (e) {
                    addTestResult('catalog-tests',
                        'addToCart –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫',
                        false,
                        `–û—à–∏–±–∫–∞: ${e.message}`
                    );
                }
            } else {
                addTestResult('catalog-tests',
                    'addToCart –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è',
                    false,
                    '–§—É–Ω–∫—Ü–∏—è addToCart –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏'
                );
            }
        }
        
        // –¢–µ—Å—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
        function testBookDetail() {
            const container = document.getElementById('book-detail-tests');
            container.innerHTML = '';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ book-detail.js
            // –¢–∞–∫ –∫–∞–∫ –º—ã –Ω–∞ –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –ø—Ä–æ–≤–µ—Ä–∏–º —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
            
            addTestResult('book-detail-tests',
                '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π book-detail.js',
                true,
                '–î–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É book-detail.html?id=1',
                { note: '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è' }
            );
        }
        
        // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
        function testIntegration() {
            const container = document.getElementById('integration-tests');
            container.innerHTML = '';
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É catalog.js –∏ cart.js
            try {
                const testId = 'integration-test-' + Date.now();
                const initialCart = window.getCartWithQuantity();
                const initialCount = Object.values(initialCart).reduce((sum, qty) => sum + qty, 0);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ audiobooks
                const originalAudiobooks = window.audiobooks || [];
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∫–Ω–∏–≥—É
                const testBook = {
                    id: testId,
                    title: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç',
                    name: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç',
                    price: 200,
                    image: 'test.jpg',
                    description: '–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏'
                };
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º audiobooks –∫–∞–∫ –º–∞—Å—Å–∏–≤ —Å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–Ω–∏–≥–æ–π
                window.audiobooks = [testBook];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–∏–≥–∞ –µ—Å—Ç—å –≤ –º–∞—Å—Å–∏–≤–µ
                const bookExists = window.audiobooks.find(b => String(b.id) === testId);
                
                if (typeof addToCart === 'function' && bookExists) {
                    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –¥–æ –≤—ã–∑–æ–≤–∞
                    const cartBeforeCall = window.getCartWithQuantity();
                    const countBeforeCall = Object.values(cartBeforeCall).reduce((sum, qty) => sum + qty, 0);
                    
                    console.log('–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:', {
                        testId,
                        booksInArray: window.audiobooks.length,
                        cartBefore: cartBeforeCall,
                        countBefore: countBeforeCall
                    });
                    
                    // –í—ã–∑—ã–≤–∞–µ–º addToCart
                    addToCart(testId);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –î–û –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –±—ã–ª)
                    const quantityBefore = cartBeforeCall[testId] || 0;
                    
                    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                    setTimeout(() => {
                        try {
                            const finalCart = window.getCartWithQuantity();
                            const finalCount = Object.values(finalCart).reduce((sum, qty) => sum + qty, 0);
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
                            const quantityAfter = finalCart[testId] || 0;
                            const quantityIncreased = quantityAfter === quantityBefore + 1;
                            const countIncreased = finalCount === initialCount + 1;
                            
                            console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:', {
                                testId,
                                quantityBefore,
                                quantityAfter,
                                finalCart,
                                finalCount,
                                initialCount,
                                quantityIncreased,
                                countIncreased
                            });
                            
                            // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                            const quantityToRemove = finalCart[testId] || 0;
                            delete finalCart[testId];
                            window.saveCartWithQuantity(finalCart);
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                            window.audiobooks = originalAudiobooks;
                            
                            // –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω –µ—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å –ò –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
                            const testPassed = quantityIncreased && countIncreased;
                            
                            addTestResult('integration-tests',
                                '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è catalog.js –∏ cart.js',
                                testPassed,
                                testPassed ? 
                                    `–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω (–±—ã–ª–æ: ${initialCount}, —Å—Ç–∞–ª–æ: ${finalCount}, —Ç–æ–≤–∞—Ä –±—ã–ª: ${quantityBefore}, —Å—Ç–∞–ª: ${quantityAfter})` : 
                                    `–¢–æ–≤–∞—Ä –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω. ID: ${testId}, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –±—ã–ª–æ: ${quantityBefore}, —Å—Ç–∞–ª–æ: ${quantityAfter}, –æ–±—â–µ–µ –±—ã–ª–æ: ${initialCount}, —Å—Ç–∞–ª–æ: ${finalCount}`
                            );
                        } catch (e2) {
                            window.audiobooks = originalAudiobooks;
                            addTestResult('integration-tests',
                                '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞',
                                false,
                                `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${e2.message}`
                            );
                        }
                    }, 300);
                } else {
                    window.audiobooks = originalAudiobooks;
                    addTestResult('integration-tests',
                        '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞',
                        false,
                        bookExists ? '–§—É–Ω–∫—Ü–∏—è addToCart –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' : `–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –º–∞—Å—Å–∏–≤–µ. ID: ${testId}, –º–∞—Å—Å–∏–≤: ${JSON.stringify(window.audiobooks)}`
                    );
                }
            } catch (e) {
                addTestResult('integration-tests',
                    '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –±–µ–∑ –æ—à–∏–±–æ–∫',
                    false,
                    `–û—à–∏–±–∫–∞: ${e.message}`
                );
            }
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
            try {
                const cart = window.getCartWithQuantity();
                const count = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
                
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                let cartCountEl = document.getElementById('cart-count');
                if (!cartCountEl) {
                    cartCountEl = document.createElement('span');
                    cartCountEl.id = 'cart-count';
                    document.body.appendChild(cartCountEl);
                }
                
                if (typeof loadCartCount === 'function') {
                    loadCartCount();
                    const displayedCount = parseInt(cartCountEl.textContent) || 0;
                    
                    addTestResult('integration-tests',
                        '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã',
                        displayedCount === count,
                        `–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è: ${displayedCount}, —Ä–µ–∞–ª—å–Ω–æ: ${count}`,
                        { displayedCount, actualCount: count }
                    );
                }
            } catch (e) {
                addTestResult('integration-tests',
                    '–¢–µ—Å—Ç —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã',
                    false,
                    `–û—à–∏–±–∫–∞: ${e.message}`
                );
            }
        }
        
        // –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        function testManualAdd() {
            const testId = '1';
            try {
                if (typeof window.addToCartWithQuantity === 'function') {
                    window.addToCartWithQuantity(testId);
                    showResult('manual-test-results', 'success', `–¢–æ–≤–∞—Ä —Å ID ${testId} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
                    setTimeout(() => showCartState(), 500);
                } else {
                    showResult('manual-test-results', 'error', '–§—É–Ω–∫—Ü–∏—è addToCartWithQuantity –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            } catch (e) {
                showResult('manual-test-results', 'error', `–û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function testManualAddMultiple() {
            const ids = ['1', '2', '3'];
            try {
                ids.forEach(id => {
                    if (typeof window.addToCartWithQuantity === 'function') {
                        window.addToCartWithQuantity(id);
                    }
                });
                showResult('manual-test-results', 'success', `–î–æ–±–∞–≤–ª–µ–Ω–æ ${ids.length} —Ç–æ–≤–∞—Ä–æ–≤`);
                setTimeout(() => showCartState(), 500);
            } catch (e) {
                showResult('manual-test-results', 'error', `–û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function clearCart() {
            try {
                if (typeof window.clearCart === 'function') {
                    window.clearCart();
                    showResult('manual-test-results', 'success', '–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞');
                    setTimeout(() => showCartState(), 500);
                } else {
                    // –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
                    window.saveCartWithQuantity({});
                    showResult('manual-test-results', 'success', '–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é');
                    setTimeout(() => showCartState(), 500);
                }
            } catch (e) {
                showResult('manual-test-results', 'error', `–û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function showCartState() {
            try {
                const cart = window.getCartWithQuantity();
                const items = Object.keys(cart).length;
                const totalQuantity = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
                
                showResult('manual-test-results', 'info', 
                    `–ö–æ—Ä–∑–∏–Ω–∞: ${items} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤, –≤—Å–µ–≥–æ ${totalQuantity} –µ–¥–∏–Ω–∏—Ü`,
                    cart
                );
            } catch (e) {
                showResult('manual-test-results', 'error', `–û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function showResult(containerId, type, message, data = null) {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `result ${type}`;
            result.innerHTML = message + (data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : '');
            container.innerHTML = '';
            container.appendChild(result);
        }
        
        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
            setTimeout(() => {
                testCartSystem();
                testCatalog();
                testBookDetail();
                testIntegration();
                
                console.log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
            }, 500);
        });
    </script>
</body>
</html>
